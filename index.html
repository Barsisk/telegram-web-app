<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–æ—Ä–º–∞ –¥–∞–Ω–Ω—ã—Ö</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .header h1 {
            color: #333;
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            background: white;
        }
        
        .submit-btn {
            width: 100%;
            padding: 12px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
        }
        
        .error {
            color: #dc3545;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É</h1>
        </div>
        
        <form id="dataForm">
            <div class="form-group">
                <label for="fio">–§–ò–û:</label>
                <input 
                    type="text" 
                    id="fio" 
                    name="fio" 
                    required 
                    placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á"
                >
                <div id="fioError" class="error">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –§–ò–û</div>
            </div>
            
            <div class="form-group">
                <label for="choice">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç:</label>
                <select id="choice" name="choice" required>
                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>
                    <option value="1">–í–∞—Ä–∏–∞–Ω—Ç 1</option>
                    <option value="2">–í–∞—Ä–∏–∞–Ω—Ç 2</option>
                </select>
                <div id="choiceError" class="error">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç</div>
            </div>
            
            <button type="submit" class="submit-btn">
                –û—Ç–ø—Ä–∞–≤–∏—Ç—å
            </button>
        </form>
        
        <div id="loading" class="loading">
            ‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
        </div>
    </div>

    <script>
        // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        function initTelegramWebApp() {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–∞—Ö–æ–¥–∏–º—Å—è –≤ Telegram WebApp
                if (window.Telegram && window.Telegram.WebApp) {
                    const tg = window.Telegram.WebApp;
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—à–∏–±–æ–∫
                    window.addEventListener('error', function(e) {
                        console.error('Global error:', e.error);
                    });
                    
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º WebApp
                    tg.ready();
                    
                    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞
                    tg.expand();
                    tg.enableClosingConfirmation();
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º –Ω–µ–Ω—É–∂–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                    if (tg.MainButton) {
                        tg.MainButton.hide();
                    }
                    
                    if (tg.BackButton) {
                        tg.BackButton.hide();
                    }
                    
                    console.log('Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                    return tg;
                }
            } catch (error) {
                console.warn('Telegram WebApp –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω:', error);
            }
            return null;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        const tg = initTelegramWebApp();
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã
        const form = document.getElementById('dataForm');
        const fioInput = document.getElementById('fio');
        const choiceSelect = document.getElementById('choice');
        const fioError = document.getElementById('fioError');
        const choiceError = document.getElementById('choiceError');
        const loading = document.getElementById('loading');
        
        // –§—É–Ω–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        function validateForm() {
            let isValid = true;
            
            fioError.style.display = 'none';
            choiceError.style.display = 'none';
            
            if (!fioInput.value.trim()) {
                fioError.style.display = 'block';
                isValid = false;
            }
            
            if (!choiceSelect.value) {
                choiceError.style.display = 'block';
                isValid = false;
            }
            
            return isValid;
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (validateForm()) {
                form.style.display = 'none';
                loading.style.display = 'block';
                
                const formData = {
                    fio: fioInput.value.trim(),
                    choice: choiceSelect.value
                };
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
                setTimeout(function() {
                    try {
                        if (tg && typeof tg.sendData === 'function') {
                            tg.sendData(JSON.stringify(formData));
                        } else {
                            // –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–Ω–µ Telegram
                            console.log('–î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:', formData);
                            alert('–î–∞–Ω–Ω—ã–µ: ' + JSON.stringify(formData));
                        }
                        
                        // –ó–∞–∫—Ä—ã–≤–∞–µ–º WebApp
                        if (tg && typeof tg.close === 'function') {
                            setTimeout(function() {
                                tg.close();
                            }, 100);
                        }
                        
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ—Ä–º—É –ø—Ä–∏ –æ—à–∏–±–∫–µ
                        form.style.display = 'block';
                        loading.style.display = 'none';
                    }
                }, 500);
            }
        });
        
        // –°–±—Ä–æ—Å –æ—à–∏–±–æ–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ
        fioInput.addEventListener('input', function() {
            fioError.style.display = 'none';
        });
        
        choiceSelect.addEventListener('change', function() {
            choiceError.style.display = 'none';
        });
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏
        window.addEventListener('load', function() {
            console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ —Ä–µ—Å—É—Ä—Å–æ–≤
        window.addEventListener('error', function(e) {
            console.warn('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ—Å—É—Ä—Å–∞:', e);
        }, true);
    </script>
</body>
</html>
